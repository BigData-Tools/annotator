<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Annotator demo</title>

    <script src="lib/vendor/jquery.js"></script>
    <script src="lib/vendor/showdown.js"></script>
    <script src="lib/xpath.js"></script>
    <script src="lib/util.js"></script>
    <script src="lib/console.js"></script>
    <script src="lib/class.js"></script>
    <script src="lib/range.js"></script>
    <script src="lib/annotator.js"></script>
    <script src="lib/widget.js"></script>
    <script src="lib/editor.js"></script>
    <script src="lib/viewer.js"></script>
    <script src="lib/notification.js"></script>
    <script src="lib/plugin/permissions.js"></script>
    <script src="lib/plugin/annotateitpermissions.js"></script>
    <script src="lib/plugin/auth.js"></script>
    <script src="lib/plugin/filter.js"></script>
    <script src="lib/plugin/kitchensink.js"></script>
    <script src="lib/plugin/markdown.js"></script>
    <script src="lib/plugin/store.js"></script>
    <script src="lib/plugin/tags.js"></script>
    <script src="lib/plugin/unsupported.js"></script>


    <link rel="stylesheet" type="text/css" href="css/annotator.css">

    <style>
      body {
        margin: 1em 0;
        padding: 0;
        font-family: "Helvetica Neue", Helvetica, sans-serif;
      }
      #controls, #content {
        margin: 0 10%;
      }
      #controls #editor {
        width: 80%;
        height: 32px;
        font-size: 16px;
        font-family: "PragmataPro";
        line-height: 16px;
      }
      #controls button.submit {
        font-size: 14px;
        margin: 10px 0 0 0;
        padding: 0.5em;
        display: block;
      }
      #controls dl {
        margin: 0 0 1em 0;
        padding: 0;
      }
      #controls dl dt {
        padding: 0.7em 0.5em;
        display: inline-block;
        border: 1px solid #aaa;
        cursor: pointer;
      }
      #controls dl dt:hover {
        background: rgb(106, 154, 202);
        color: #fff;
      }
      #controls dl dt.active {
        font-weight: bold;
      }
      #controls dl dd {
        display: none;
      }
    </style>

  </head>

  <body>
    <div id="controls">
      <form id="demo" action="">
        <dl>
          <dt>start</dt>
          <dd>
$('#content').annotator();
          </dd>
          <dt>tags</dt>
          <dd>
$('#content').annotator()
             .annotator('addPlugin', 'Tags');
          </dd>
          <dt>markdown</dt>
          <dd>
$('#content').annotator()
             .annotator('addPlugin', 'Markdown');
          </dd>
          <dt>store</dt>
          <dd>
$('#content').annotator()
             .annotator('addPlugin', 'Tags')
             .annotator('addPlugin', 'Store', {
                          prefix: 'http://localhost:5200',
                        });
          </dd>
          <dt>kitchensink</dt>
          <dd>
$('#content').annotator()
             .annotator('setupPlugins');
          </dd>
        </dl>
        <div id="editor"></div>
        <!-- <textarea></textarea> -->
        <button class=submit>Update &raquo;</button>
      </form>
    </div>

    <div id="content">
      <p><strong>Pellentesque habitant morbi tristique</strong> senectus et netus et malesuada fames ac turpis egestas. Vestibulum tortor quam, feugiat vitae, ultricies eget, tempor sit amet, ante. Donec eu libero sit amet quam egestas semper. <em>Aenean ultricies mi vitae est.</em> Mauris placerat eleifend leo. Quisque sit amet est et sapien ullamcorper pharetra. Vestibulum erat wisi, condimentum sed, <code>commodo vitae</code>, ornare sit amet, wisi. Aenean fermentum, elit eget tincidunt condimentum, eros ipsum rutrum orci, sagittis tempus lacus enim ac dui. <a href="#">Donec non enim</a> in turpis pulvinar facilisis. Ut felis.</p>

      <h2>Header Level 2</h2>

      <ol>
         <li>Lorem ipsum dolor sit amet, consectetuer adipiscing elit.</li>
         <li>Aliquam tincidunt mauris eu risus.</li>
      </ol>

      <blockquote><p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Vivamus magna. Cras in mi at felis aliquet congue. Ut a est eget ligula molestie gravida. Curabitur massa. Donec eleifend, libero at sagittis mollis, tellus est malesuada tellus, at luctus turpis elit sit amet quam. Vivamus pretium ornare est.</p></blockquote>

      <h3>Header Level 3</h3>

      <ul>
         <li id="listone">Lorem ipsum dolor sit amet, consectetuer adipiscing elit.</li>
         <li id="listtwo">Aliquam tincidunt mauris eu risus.</li>
      </ul>

      <pre><code>
      #header h1 a {
        display: block;
        width: 300px;
        height: 80px;
      }
      </code></pre>
    </div>

    <script src="ace/ace.js" type="text/javascript" charset="utf-8"></script>
    <script src="ace/keybinding-vim.js" type="text/javascript" charset="utf-8"></script>
    <script>
      jQuery(function ($) {

        var editorContainer = $("#editor");
        var editor = ace.edit("editor");
        editor.setKeyboardHandler(ace.require("ace/keyboard/vim").handler);
        editor.getSession().setMode("ace/mode/javascript");

        var autosize = function () {
          var h = (editor.getSession().getScreenLength() + 1)
                  * editor.renderer.lineHeight
                  + editor.renderer.scrollBar.getWidth();
          editorContainer.height(h);
          //editorContainer.find(':first-child').height(h);
          editor.resize(true);
        };

        editor.getSession().on('change', autosize);

        var setval = function (value) {
          editor.setValue(value);
          editor.navigateFileEnd();
        };

        var evil = function () {
          eval(editor.getValue());
        };

        $("#controls").on('click', 'dt', function () {
          window.location.hash = '#' + $(this).text().trim();
          setval($(this).next('dd').text().trim());
          $('#controls form').submit();
        });

        $("#controls").on('submit', 'form', function (e) {
          e.preventDefault();
          var ann = $("#content").data('annotator');
          if (ann != null) {
            ann.destroy();
          }
          evil();
        });

        $('#content').on('click', '.annotator-hl', function () {
          console.debug($(this).data());
        });

        // Load state from location.hash
        $('#controls dt').each(function () {
          if ('#' + $(this).text().trim() === window.location.hash) {
            setval($(this).next('dd').text().trim());
            evil();
          }
        });

      });
    </script>
  </body>


</html>
